{% extends "auctions/layout.html" %}

{% block title %}
    {{ post.item.name }}
{% endblock %}

{% block body %}
    <div class="container-fluid p-0">
        {% if post.winner %}
        <div class="row alert alert-info m-1">
            {% if user.is_authenticated and user == post.winner %}
                You have won this listing 
            {% else %}
                This listing is closed.
            {% endif %}
        </div>
        {% endif %}
        <div class="row">
            <div class="col-9">

                {% include "reusables/item_info.html" with post=post %}
                
                <div class="row">
                    <h2>Comments:</h2>
                
                    {% if user.is_authenticated %}
                        <form action="{% url 'comment' post_id=post.id %}" method="POST">
                            {% csrf_token %}
                            {{ commentform }}
                            <button type="submit">Comment</button>
                        </form>
                    {% endif %}
                
                    {% if comments %}
                        <ul>
                            {% for comment in comments %}
                                <li>{{ comment.comment_datetime }}: {{ comment }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div>No Comments.</div>
                    {% endif %}
                </div>
            </div>

            <div class="col-md-3 border border-black">
                <h2>Bids:</h2>
                {% if user.is_authenticated and not post.winner %}
                    <form action="{% url 'bid' post_id=post.id %}" method="POST">
                        {% csrf_token %}
                        {{ bidform.amount }}
                        <button type="submit">Bid</button>
                    </form>
                {% endif %}
            
                {% if bids %}
                    <ul>
                        {% for bid in bids %}
                            <li>{{ bid.bid_datetime }}: {{ bid }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div>No bids.</div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}